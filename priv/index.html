<html>
  <script language="JavaScript">
    function q(from, to){
      var oldScript = document.getElementById("fetch");
      if(oldScript){
        oldScript.remove();
      }
      var s = document.createElement("script");
      s.src = "http://localhost:8080/?callback=load&from=" + from + "&to=" + to;
      s.id = "fetch";

      s.onload = function() { 
        console.log('script loaded.');
        loadTable();
      };

      document.body.appendChild(s);

    }

    function loadTable(){
      var records = load();

      var oldTable = document.getElementById("table1");
      if(oldTable){
        oldTable.remove();
      }
      var table = document.createElement("table");
      table.id = "table1";
      records.forEach(tableWriter(table));
      document.body.appendChild(table);
    }

    function tableWriter(table){
      return function(obj){
               console.log('element');
               var row = table.insertRow();
               var i = 0
               var cell;
               for (var k in obj){
                 cell = row.insertCell(i);
                 cell.innerHTML = obj[k];
                 i++;
               }
             }
    }

  </script>
  <body>
  </body>
</html>
