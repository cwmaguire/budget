<html>
  <script language="JavaScript">
    function q(){
      console.log("Running function q");
      var oldScript = document.getElementById("fetch");
      var fromDate = get_val("fromDateText");
      var toDate = get_val("toDateText");
      console.log("From date: " + fromDate);
      console.log("To date: " + toDate);
      if(oldScript){
        oldScript.remove();
      }
      var s = document.createElement("script");
      s.src = "http://localhost:8080/?callback=load&from="
        + fromDate
        + "&to="
        + toDate;
      s.id = "fetch";

      s.onload = function() {
        loadTable();
      };

      document.body.appendChild(s);

    }

    function loadTable(){
      var records = load();

      var oldTable = document.getElementById("table1");
      if(oldTable){
        oldTable.remove();
      }
      var table = document.createElement("table");
      table.id = "table1";
      console.log('# recs: ' + records.length);
      records.forEach(tableWriter(table));
      document.body.appendChild(table);
    }

    function tableWriter(table){
      return function(obj){
               console.log('element');
               var row = table.insertRow();
               var i = 0
               var cell;
               for (var k in obj){
                 cell = row.insertCell(i);
                 cell.innerHTML = obj[k];
                 i++;
               }
             }
    }

    function get_val(Id){
      var element = document.getElementById(Id);
      return element.value;
    }

  </script>
  <body>
    <table>
      <tr>
        <td>
          From:
        </td>
        <td>
          <input id="fromDateText" type="text" value="2018-10-01">
        </td>
      </tr>
      <tr>
        <td>
          To:
        </td>
        <td>
          <input id="toDateText" type="text" value="2018-10-03">
        </td>
      </tr>
    </table>
    <br>
    <button display="query" text="query" onclick="q();">Query</button>
  </body>
</html>
